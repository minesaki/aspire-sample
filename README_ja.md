# .NET Aspire サンプル
このサンプルアプリは .NET Aspire を使用したマイクロサービスの実装例です。

## .NET Aspire とは
マイクロサービスなどの分散アプリケーションを効率的に開発するための .NET のツールセット。  
分散アプリケーションに必要な、オーケストレーション、サービスディスカバリ、可観測性、回復性などを素早く容易に導入でき、またこれらの構成を C# コードで実装できる。  
なお、分散アプリケーション以外の開発にも十分有用。

.NET Aspire の導入方法については [how_to_start_aspire_ja.md](https://github.com/minesaki/aspire-sample/blob/main/how_to_start_aspire_ja.md) を参照。

### オーケストレーション
ローカルでの開発時に、複数のアプリケーションや依存関係をまとめて起動・管理できる。  
対応する .NET Aspire パッケージが提供されている場合、Docker上で自動的に起動・停止できる。例えば、アプリがRedisとPostgreSQLを使用する場合、これらは .NET Aspire パッケージが存在するので、自動的に起動・停止させることができる。  
また、依存先が使用可能になるまでアプリの起動を遅延させるなどの制御も可能。

### サービスディスカバリ
各アプリ・依存関係の接続情報（IPアドレス、ポート等）は、起動ごと、あるいは環境ごとに変わる場合があり、管理が煩雑。
サービスディスカバリにより、コード上で名前による依存先へのアクセスが可能に。

### 可観測性 (Observability)
どのようなアプリケーションでも状態を観測できるようにしておくことは大事だが、特に分散アプリケーションでは、アプリケーション同士が複雑に相互作用して状態の把握が難しくなるため、可観測性の確保はより重要になる。 .NET Aspire を使用することにより、可観測性のためのアプリケーション設定が容易に行え、状態を監視するためのダッシュボードも利用できるため、開発中の可観測性を容易に確保できる。  

※運用環境では、一般的にOSS（Prometheus, Grafana, Jaeger, Kibanaなど）やクラウドの監視基盤を使うと思われるが、.NET Aspire によりOpenTelemetry向けの設定ができているため、容易に対応可能。

下記の情報を収集・可視化する。

#### メトリック
アプリの使用するCPUやメモリ、受け付けているアクセス数などの、様々な計測値。Grafanaなどの可視化ツールを使って、各計測値ごとにグラフを作ったり、複数のグラフを一度に参照できるダッシュボードを作ったりして可視化する。

#### トレーシング
アプリケーションの各種処理の開始・終了などの情報。分散アプリケーションでは、全てのアプリからトレース情報を収集・集約する。リクエストごとに一意のID（TraceID）が割り振られ、依存先（別のアプリ）を呼び出す際はTraceIDを伝搬するので、トレース情報をあるTraceIDで抽出すると、「あるアプリAが別のアプリBを呼び、さらにそれがまた別のアプリCを呼んだ」、「その各処理は何ミリ秒かかった」、といったことが分かる。これを可視化するとシーケンス図のような図が得られ、分散アプリケーション間の処理内容やパフォーマンス、エラーの発生個所などが把握しやすくなる。

#### ログ
アプリケーションのログ。分散アプリケーションでは、全てのアプリのログが集約されて一か所で参照・検索できること、また構造化ログ（様々な情報がメッセージとは分離された個別の項目に保持されており、各項目を対象に検索可能）であることが望ましい。

### 回復性 (Resiliency)
分散アプリケーションはネットワークで接続されているが、ネットワークの瞬断や一時的な高負荷など、様々な要因でリクエストが失敗する場合がある。 .NET Aspire により、タイムアウト、リトライ、サーキットブレーカーなどが容易に導入でき、一時的な障害からの回復力を持ったアプリを実装しやすくなる。
